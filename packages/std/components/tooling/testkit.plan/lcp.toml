schemaVersion = "2.0"
id = "lcod://tooling/testkit/plan@0.1.0"
version = "0.1.0"
kind = "component"
summary = "Aggregate multiple testkit/unit cases, producing a consolidated report."

[palette]
category = "Testing"
icon = "mdi:clipboard-list"
tags = ["test", "automation", "reports"]

[deps]
requires = [
  "lcod://tooling/script@1"
]

[inputs.id]
summary = "Stable identifier for the plan."
required = false
schema = """{"type":"string"}"""

[inputs.name]
summary = "Human-friendly name displayed in the final report."
required = false
schema = """{"type":"string"}"""

[inputs.description]
summary = "Optional free-text description of the plan."
required = false
schema = """{"type":"string"}"""

[inputs.metadata]
summary = "Plan-level metadata forwarded to the tests slot."
required = false
schema = """{"type":"object"}"""

[inputs.context]
summary = "Context object forwarded to the tests slot."
required = false
schema = """{"type":"object"}"""

[inputs.tests]
summary = "Optional array of precomputed test results to merge (useful for static reporting)."
required = false
schema = """{"type":"array"}"""

[slots.tests]
    summary = "Must produce an array of test results (typically by calling testkit/unit)."

[outputs.plan]
summary = "Aggregated report with plan metadata, summary counts, and individual cases."
schema = """
{
  "type": "object",
  "properties": {
    "id": { "type": ["string", "null"] },
    "name": { "type": ["string", "null"] },
    "description": { "type": ["string", "null"] },
    "metadata": { "type": ["object", "null"] },
    "context": { "type": ["object", "null"] },
    "status": { "type": "string" },
    "startedAt": { "type": "string" },
    "finishedAt": { "type": "string" },
    "durationMs": { "type": "number" },
    "summary": {
      "type": "object",
      "properties": {
        "total": { "type": "number" },
        "passed": { "type": "number" },
        "failed": { "type": "number" },
        "error": { "type": "number" },
        "skipped": { "type": "number" }
      }
    },
    "cases": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": { "type": ["string", "null"] },
          "name": { "type": ["string", "null"] },
          "description": { "type": ["string", "null"] },
          "metadata": { "type": ["object", "null"] },
          "status": { "type": "string" },
          "output": {}
        }
      }
    },
    "error": { "type": ["object", "null"] }
  }
}
"""
