schemaVersion = "2.0"
id = "lcod://tooling/testkit/unit@0.1.0"
version = "0.1.0"
kind = "component"
summary = "Run an embedded compose-based test case inside the current kernel."

[palette]
category = "Testing"
icon = "mdi:beaker-check"
tags = ["test", "quality", "automation"]

[deps]
requires = [
  "lcod://tooling/script@1",
  "lcod://tooling/value.deep_equal@0.1.0"
]

[inputs.id]
summary = "Stable identifier for the test (used in reports)."
required = false
schema = """{"type":"string"}"""

[inputs.name]
summary = "Human-friendly name displayed in reports."
required = false
schema = """{"type":"string"}"""

[inputs.description]
summary = "Optional free-text description of the scenario."
required = false
schema = """{"type":"string"}"""

[inputs.metadata]
summary = "Arbitrary metadata forwarded to verify/teardown slots and returned in the report."
required = false
schema = """{"type":"object"}"""

[inputs.context]
summary = "Context object forwarded to setup/verify slots."
required = false
schema = """{"type":"object"}"""

[inputs.targetInput]
summary = "Payload forwarded to the target slot."
required = false
schema = """{"type":"object"}"""

[inputs.setupInput]
summary = "Payload forwarded to the setup slot when provided."
required = false
schema = """{"type":"object"}"""

[inputs.verifyInput]
summary = "Additional payload forwarded to the verify slot."
required = false
schema = """{"type":"object"}"""

[inputs.teardownInput]
summary = "Additional payload forwarded to the teardown slot."
required = false
schema = """{"type":"object"}"""

[inputs.expect]
summary = "Expected value compared against the target output (deep equality)."
required = false
schema = """{}"""

[inputs.skipSetup]
summary = "Disable the setup slot even if provided."
required = false
schema = """{"type":"boolean"}"""

[inputs.skipTeardown]
summary = "Disable the teardown slot even if provided."
required = false
schema = """{"type":"boolean"}"""

[slots.setup]
summary = "Optional compose steps executed before the target call."

[slots.target]
summary = "Compose steps that exercise the component under test."

[slots.verify]
summary = "Optional verification hook receiving { output, expect, metadata, assertion }."

[slots.teardown]
summary = "Optional cleanup hook executed after the test."

[outputs.result]
summary = "Structured report for the test case."
schema = """
{
  "type": "object",
  "properties": {
    "id": { "type": ["string", "null"] },
    "name": { "type": ["string", "null"] },
    "description": { "type": ["string", "null"] },
    "metadata": { "type": ["object", "null"] },
    "status": { "type": "string" },
    "startedAt": { "type": "string" },
    "finishedAt": { "type": "string" },
    "durationMs": { "type": "number" },
    "output": {},
    "expect": {},
    "assertion": {
      "type": ["object", "null"],
      "properties": {
        "equal": { "type": ["boolean", "null"] },
        "actualSnapshot": { "type": ["string", "null"] },
        "expectedSnapshot": { "type": ["string", "null"] }
      }
    },
    "verify": {},
    "setup": {},
    "teardown": {},
    "error": { "type": ["object", "null"] },
    "teardownError": { "type": ["object", "null"] }
  },
  "required": ["status", "startedAt", "finishedAt", "durationMs"]
}
"""
