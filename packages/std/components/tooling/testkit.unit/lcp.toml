schemaVersion = "2.0"
id = "lcod://tooling/testkit/unit@0.1.0"
version = "0.1.0"
kind = "component"
summary = "Run an embedded compose-based test case inside the current kernel."

[palette]
category = "Testing"
icon = "mdi:beaker-check"
tags = ["test", "quality", "automation"]

[deps]
requires = [
  "lcod://flow/if@1",
  "lcod://tooling/value.deep_equal@0.1.0",
  "lcod://tooling/value/default_object@0.1.0",
  "lcod://tooling/value/is_defined@0.1.0",
  "lcod://core/object/merge@0.1.0",
  "lcod://contract/compose/run_slot@1",
  "lcod://tooling/testkit/normalize_output@0.1.0",
  "lcod://impl/set@1"
]

[inputs.id]
summary = "Stable identifier for the test (used in reports)."
required = false
schema = """{"type":"string"}"""

[inputs.name]
summary = "Human-friendly name displayed in reports."
required = false
schema = """{"type":"string"}"""

[inputs.description]
summary = "Optional free-text description of the scenario."
required = false
schema = """{"type":"string"}"""

[inputs.metadata]
summary = "Arbitrary metadata forwarded to verify/teardown slots and returned in the report."
required = false
schema = """{"type":"object"}"""

[inputs.context]
summary = "Context object forwarded to setup/verify slots."
required = false
schema = """{"type":"object"}"""

[inputs.targetInput]
summary = "Payload forwarded to the target slot."
required = false
schema = """{"type":"object"}"""

[inputs.setupInput]
summary = "Payload forwarded to the setup slot when provided."
required = false
schema = """{"type":"object"}"""

[inputs.verifyInput]
summary = "Additional payload forwarded to the verify slot."
required = false
schema = """{"type":"object"}"""

[inputs.teardownInput]
summary = "Additional payload forwarded to the teardown slot."
required = false
schema = """{"type":"object"}"""

[inputs.expect]
summary = "Expected value compared against the target output (deep equality)."
required = false
schema = """{}"""

[inputs.skipSetup]
summary = "Disable the setup slot even if provided."
required = false
schema = """{"type":"boolean"}"""

[inputs.skipTeardown]
summary = "Disable the teardown slot even if provided."
required = false
schema = """{"type":"boolean"}"""

[slots.setup]
summary = "Optional compose steps executed before the target call."

[slots.target]
summary = "Compose steps that exercise the component under test."

[slots.verify]
summary = "Optional verification hook receiving { output, expect, metadata, assertion }."

[slots.teardown]
summary = "Optional cleanup hook executed after the test."

[outputs.result]
summary = "Simplified report for the test case."
schema = """
{
  "type": "object",
  "properties": {
    "id": { "type": ["string", "null"] },
    "name": { "type": ["string", "null"] },
    "description": { "type": ["string", "null"] },
    "metadata": { "type": ["object", "null"] },
    "success": { "type": "boolean" },
    "output": {},
    "expect": {},
    "difference": {
      "type": ["object", "null"],
      "properties": {
        "actual": {},
        "expected": {}
      }
    },
    "assertion": {
      "type": ["object", "null"],
      "properties": {
        "equal": { "type": ["boolean", "null"] },
        "actualSnapshot": {},
        "expectedSnapshot": {}
      }
    },
    "setup": { "type": ["object", "null"] },
    "target": { "type": ["object", "null"] },
    "verify": { "type": ["object", "null"] },
    "teardown": { "type": ["object", "null"] }
  },
  "required": ["success"]
}
"""
